<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Demo Práctica: Consumo de APIs con JavaScript</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="CSS/Demo-estilo.css" />
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
    <style>
      body {
        font-family: "Inter", sans-serif;
        margin: 20px;
      }
      section {
        margin-bottom: 40px;
      }
      #map {
        height: 300px;
      }
      .api-demo,
      .demo-output {
        background: #f4f4f4;
        padding: 10px;
        border-radius: 5px;
        margin-top: 10px;
      }
      textarea {
        width: 100%;
        height: 100px;
      }
      pre {
        background: #272822;
        color: #f8f8f2;
        padding: 10px;
        border-radius: 4px;
        overflow-x: auto;
      }
      .result {
        background: #e7ffe7;
        padding: 10px;
        margin-top: 10px;
        border: 1px solid #ccc;
      }
    </style>
  </head>
  <body>
    <h1>Demo Práctica: APIs con JavaScript</h1>
    <header>
      <section>
        <a href="index.html" style="color: white; text-decoration: none"
          ><p>Consumo de APIs con JavaScript</p></a
        >
      </section>
    </header>
    <!-- 1. JSON Parse/Stringify -->
    <section>
      <h2>1. Codificación y decodificación JSON</h2>
      <p>Escriba un objeto JSON válido y conviértalo a objeto JS:</p>
      <textarea id="jsonInput">{"nombre":"Ana","edad":25}</textarea>
      <button onclick="parseJSON()">Convertir a Objeto JS</button>
      <div class="result" id="jsonResult"></div>
      <p>Y ahora convertir un objeto JS a texto JSON:</p>
      <button onclick="stringifyJSON()">Convertir objeto a JSON</button>
      <div class="result" id="stringifyResult"></div>
    </section>

    <!-- 2. Métodos HTTP -->
    <section>
      <h2>2. Métodos HTTP (Fetch API)</h2>
      <button onclick="getPost()">GET</button>
      <button onclick="createPost()">POST</button>
      <button onclick="updatePost()">PUT</button>
      <button onclick="deletePost()">DELETE</button>
      <div class="demo-output" id="httpOutput"></div>
    </section>

    <!-- 3. XMLHttpRequest -->
    <section>
      <h2>3. AJAX con XMLHttpRequest</h2>
      <button onclick="xhrGet()">Cargar Post con XHR</button>
      <div class="demo-output" id="xhrOutput"></div>
    </section>

    <!-- 4. jQuery AJAX -->
    <section>
      <h2>4. jQuery AJAX</h2>
      <button onclick="jqueryDelete()">Eliminar Post con jQuery</button>
      <div class="demo-output" id="jqueryOutput"></div>
    </section>

    <!-- 5. Mapa Leaflet -->
    <section>
      <h2>5. Mapa interactivo (Leaflet)</h2>
      <div id="map"></div>
    </section>

    <!-- 6. Captcha con reCAPTCHA -->
    <section>
      <h2>6. Captcha con Google reCAPTCHA v2</h2>
      <form id="captcha-form">
        <div
          class="g-recaptcha"
          data-sitekey="6LcjbZkrAAAAAGQvLpb1FBlMSUfIAozGsNlMJIUU"
        ></div>
        <br />
        <button type="submit">Verificar</button>
        <p id="captcha-message"></p>
      </form>
    </section>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
      // JSON
      function parseJSON() {
        try {
          const obj = JSON.parse(document.getElementById("jsonInput").value);
          document.getElementById(
            "jsonResult"
          ).textContent = `Nombre: ${obj.nombre}, Edad: ${obj.edad}`;
        } catch (e) {
          document.getElementById("jsonResult").textContent = "JSON inválido";
        }
      }
      function stringifyJSON() {
        const persona = { nombre: "Carlos", edad: 30 };
        const json = JSON.stringify(persona);
        document.getElementById("stringifyResult").textContent = json;
      }

      // Métodos HTTP
      function getPost() {
        fetch("https://jsonplaceholder.typicode.com/posts/1")
          .then((res) => res.json())
          .then(
            (data) =>
              (document.getElementById("httpOutput").textContent =
                JSON.stringify(data, null, 2))
          );
      }
      function createPost() {
        fetch("https://jsonplaceholder.typicode.com/posts", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            title: "Nuevo",
            body: "Contenido",
            userId: 1,
          }),
        })
          .then((res) => res.json())
          .then(
            (data) =>
              (document.getElementById("httpOutput").textContent =
                JSON.stringify(data, null, 2))
          );
      }
      function updatePost() {
        fetch("https://jsonplaceholder.typicode.com/posts/1", {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            id: 1,
            title: "Actualizado",
            body: "Texto nuevo",
            userId: 1,
          }),
        })
          .then((res) => res.json())
          .then(
            (data) =>
              (document.getElementById("httpOutput").textContent =
                JSON.stringify(data, null, 2))
          );
      }
      function deletePost() {
        fetch("https://jsonplaceholder.typicode.com/posts/1", {
          method: "DELETE",
        }).then(
          () =>
            (document.getElementById("httpOutput").textContent =
              "Post eliminado")
        );
      }

      // XMLHttpRequest
      function xhrGet() {
        const xhr = new XMLHttpRequest();
        xhr.open("GET", "https://jsonplaceholder.typicode.com/posts/2");
        xhr.onload = () => {
          if (xhr.status === 200) {
            const data = JSON.parse(xhr.responseText);
            document.getElementById("xhrOutput").textContent = JSON.stringify(
              data,
              null,
              2
            );
          }
        };
        xhr.send();
      }

      // jQuery AJAX
      function jqueryDelete() {
        $.ajax({
          url: "https://jsonplaceholder.typicode.com/posts/3",
          method: "DELETE",
        }).done(() => $("#jqueryOutput").text("Post eliminado con jQuery."));
      }

      // Leaflet Mapa
      const map = L.map("map").setView([9.935, -84.0853], 13);
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution: "© OpenStreetMap contributors",
      }).addTo(map);
      L.marker([9.935, -84.0853])
        .addTo(map)
        .bindPopup("San José, Costa Rica")
        .openPopup();

      // Captcha
      document
        .getElementById("captcha-form")
        .addEventListener("submit", function (e) {
          e.preventDefault();
          const response = grecaptcha.getResponse();
          if (response.length === 0) {
            document.getElementById("captcha-message").innerText =
              "Por favor verifica el captcha.";
          } else {
            document.getElementById("captcha-message").innerText =
              "Captcha completado correctamente (cliente).";
          }
        });
    </script>
  </body>
</html>
